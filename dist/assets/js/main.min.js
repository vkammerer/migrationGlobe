"use strict";!function(){var e={};e.vertex1="\n		void main() {\n			gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n		}\n	",e.fragment1="\n		uniform vec3 color;\n		uniform float opacity;\n		void main() {\n			gl_FragColor = vec4(color, opacity);\n		}\n	",window.Shaders=e}(),function(){var e=function(e){e=e||{};var t=e.radius||200,n=e.widthSegments||40,i=e.heightSegments||30,o=e.texture||"assets/img/world.jpg",a=THREE.ImageUtils.loadTexture(o),r=e.material||new THREE.MeshBasicMaterial({map:a}),s=new THREE.SphereGeometry(t,n,i),d=new THREE.Mesh(s,r);return d.rotation.y=Math.PI,d};window.Globe=e}(),function(){var e=function(e){this.mesh=e};e.prototype.quadraticFlux=function(e,t,n,i){var o=this.coordToPoint(e,t),a=this.coordToPoint(n,i),r=o.clone().sub(a).length(),s=o.clone().add(a).multiplyScalar(.5);s.sub(this.mesh.position),s.normalize(),s.multiplyScalar(this.mesh.geometry.radius+.7*r),s.add(this.mesh.position);var d=new THREE.QuadraticBezierCurve3(o,s,a),l=new THREE.CurvePath;l.add(d);var u=l.createPointsGeometry(100);return u},e.prototype.cubicFlux=function(e,t,n,i){var o=this.coordToPoint(e,t),a=this.coordToPoint(n,i),r=o.clone().sub(a).length(),s=o.clone().sub(this.mesh.position);s.normalize(),s.multiplyScalar(r),s.add(o);var d=a.clone().sub(this.mesh.position);d.normalize(),d.multiplyScalar(r),d.add(a);var l=new THREE.CubicBezierCurve3(o,s,d,a),u=new THREE.CurvePath;u.add(l);var c=u.createPointsGeometry(100);return c},e.prototype.doubleCubicFlux=function(e,t,n,i){var o=this.coordToPoint(e,t),a=this.coordToPoint(n,i),r=o.clone().sub(a).length(),s=o.clone().add(a).multiplyScalar(.5);s.sub(this.mesh.position),s.normalize(),s.multiplyScalar(this.mesh.geometry.radius+.2*r),s.add(this.mesh.position);var d=o.clone().sub(a);d.normalize();var l=s.clone().add(d.clone().multiplyScalar(r/2)),u=s.clone().add(d.clone().multiplyScalar(-r/2)),c=new THREE.CubicBezierCurve3(o,o,l,s),h=new THREE.CubicBezierCurve3(s,u,a,a),m=c.getPoints(50);m=m.splice(0,m.length-1),m=m.concat(h.getPoints(50));var p=new THREE.Geometry;return p.vertices=m,p},e.prototype.coordToPoint=function(e,t){var n=(90-e)*Math.PI/180,i=(180-t)*Math.PI/180,o=new THREE.Vector3;return o.x=this.mesh.geometry.radius*Math.sin(n)*Math.cos(i),o.y=this.mesh.geometry.radius*Math.cos(n),o.z=this.mesh.geometry.radius*Math.sin(n)*Math.sin(i),o.add(this.mesh.position),o},window.Flux=e}(),function(){function e(){o=document.getElementById("container");var e=window.innerWidth,n=window.innerHeight;r=new THREE.PerspectiveCamera(45,e/n,1,2e3),r.position.z=1500,s=new THREE.OrbitControls(r),s.minDistance=500,s.maxDistance=2e3,s.addEventListener("change",i),a=new Stats,document.body.appendChild(a.domElement),l=new THREE.WebGLRenderer({antialias:!0}),l.setSize(e,n),l.domElement.style.position="absolute",o.appendChild(l.domElement),d=new THREE.Scene,d.fog=new THREE.Fog(1118481,1800,2e3),window.addEventListener("resize",t,!1);var h=new Globe({texture:"assets/img/world_4k.jpg",radius:300});d.add(h);var m=new Flux(h);u={opacity:{type:"f",value:.7},color:{type:"c",value:new THREE.Color(16711680)}};var p=new THREE.ShaderMaterial({uniforms:u,attributes:c,vertexShader:Shaders.vertex1,fragmentShader:Shaders.fragment1,blending:THREE.AdditiveBlending,depthTest:!0,transparent:!0,linewidth:2}),E={latitude:47.21176,longitude:-1.573},w=new XMLHttpRequest;w.open("GET","assets/data/capitals.json",!0),w.onreadystatechange=function(){if(4===w.readyState&&200===w.status)for(var e,t=JSON.parse(w.responseText),n=0;n<t.length;n++){e=t[n],console.log(e.capital);var i=m.doubleCubicFlux(E.latitude,E.longitude,e.latitude,e.longitude),o=new THREE.Line(i,p,THREE.LinePieces);d.add(o)}},w.send(null)}function t(){r.aspect=window.innerWidth/window.innerHeight,r.updateProjectionMatrix(),l.setSize(window.innerWidth,window.innerHeight),i()}function n(){requestAnimationFrame(n),i(),a.update(),s.update()}function i(){var e=.001*Date.now();u.opacity.value=Math.min(1,.5+Math.sin(e)),u.color.value.offsetHSL(5e-4,0,0),l.render(d,r)}Detector.webgl||Detector.addGetWebGLMessage();var o,a,r,s,d,l,u,c;e(),n()}();