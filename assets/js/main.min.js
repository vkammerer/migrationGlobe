"use strict";!function(){var e={};e.noopVertex="\n		varying vec2 vUv;\n\n		void main() {\n			vUv = uv;\n			gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n		}\n	",e.fluxFragment="\n		uniform vec3 color;\n		uniform sampler2D texture;\n		uniform float displacement;\n		varying vec2 vUv;\n\n		void main() {\n			vec4 texColor = texture2D(texture, vec2(vUv.x+displacement, vUv.y));\n			gl_FragColor = texColor*vec4(color,1.0);\n		}\n	",e.globeFragment="\n		uniform sampler2D worldMap;\n		uniform sampler2D bordersMap;\n		uniform sampler2D continentsMap;\n		uniform sampler2D indexMap;\n		uniform float clicked;\n		uniform vec3 borderColor;\n		varying vec2 vUv;\n\n		void main() {\n			vec4 borders = texture2D(bordersMap, vUv);\n			vec4 world = texture2D(worldMap, vUv) * 2.0;\n			vec4 continents = texture2D(continentsMap, vUv) / 5.0;\n			vec4 index = texture2D(indexMap, vUv);\n\n			vec4 globeCol = vec4(0.0, 0.0, 1.0, 1.0);\n\n			if (abs(clicked-index.r)<0.0035 && clicked/index.r >0.0) {\n				globeCol = vec4(borderColor,1.0);\n			}\n			float r = globeCol.r*world.r + borders.r + continents.r;\n			float g = globeCol.g*world.g + borders.g + continents.g;\n			float b = globeCol.b*world.b + borders.b + continents.b;\n			gl_FragColor = vec4(r,g,b,1.0);\n		}\n	",window.Shaders=e}(),function(){var e={};e.xyzToLatLon=function(e,t){var n=90-180*Math.acos(e.y/t.geometry.radius)/Math.PI,o=(270+180*Math.atan2(e.x,e.z)/Math.PI)%360;return o>=180&&(o-=360),console.log(n,o),{lat:n,lon:o}},e.latLonToXyz=function(e,t,n){var o=e*Math.PI/180,r=t*Math.PI/180,a=new THREE.Vector3;return a.x=n.geometry.radius*Math.cos(o)*Math.cos(r),a.y=n.geometry.radius*Math.sin(o),a.z=-n.geometry.radius*Math.cos(o)*Math.sin(r),a.add(n.position),a},e.getIndex=function(t,n,o){var r=new Image;r.src="assets/img/indexed_map.png",r.onload=function(){var a=e.xyzToLatLon(t,n),i=Math.floor(a.lon/360*r.width+r.width/2),l=Math.floor(-a.lat/360*r.width+r.height/2);i>r.width&&(i-=r.width),l>r.height&&(l-=r.height);var s=document.createElement("canvas");s.width=r.width,s.height=r.height,s.getContext("2d").drawImage(r,0,0,r.width,r.height);var d=s.getContext("2d").getImageData(i,l,1,1).data;o(d[0])}},e.getCountryCodeFromIndex=function(e,t){var n=new XMLHttpRequest;n.open("GET","assets/data/indexed_countries.json",!0),n.onreadystatechange=function(){if(4===n.readyState&&200===n.status){var o=JSON.parse(n.responseText);t(o[e-1])}},e>0?n.send(null):t(null)},e.geoJsonToGeometry=function(t,n){var o,r=new THREE.Geometry;if("Polygon"===t.geometry.type)o=t.geometry.coordinates,e.computePolygon(o,r,n);else if("MultiPolygon"===t.geometry.type)for(var a=t.geometry.coordinates,i=0;i<a.length;i++)o=a[i],e.computePolygon(o,r,n);return r},e.computePolygon=function(t,n,o){for(var r=0;r<t.length;r++)for(var a=t[r],i=0;i<a.length;i++){var l=a[i],s=e.latLonToXyz(l[1],l[0],o);n.vertices.push(s),0!==i&&i!==a.length-1&&n.vertices.push(s)}},window.GeoUtils=e}(),function(){var e=function(e){e=e||{};var t=e.radius||200,n=e.widthSegments||40,o=e.heightSegments||30,r=e.texture||"assets/img/world.jpg",a=THREE.ImageUtils.loadTexture(r),i=e.material||new THREE.MeshBasicMaterial({map:a}),l=new THREE.SphereGeometry(t,n,o),s=new THREE.Mesh(l,i);return s};window.Globe=e}(),function(){var e=function(e,t){this.mesh=e,this.numberOfPoints=t||50};e.prototype.quadraticFlux=function(e,t,n,o){var r=GeoUtils.latLonToXyz(e,t,this.mesh),a=GeoUtils.latLonToXyz(n,o,this.mesh),i=r.clone().sub(a).length(),l=r.clone().add(a).multiplyScalar(.5);l.sub(this.mesh.position),l.normalize(),l.multiplyScalar(this.mesh.geometry.radius+.7*i),l.add(this.mesh.position);var s=new THREE.QuadraticBezierCurve3(r,l,a),d=new THREE.CurvePath;d.add(s);var u=d.createPointsGeometry(this.numberOfPoints);return u},e.prototype.cubicFlux=function(e,t,n,o){var r=GeoUtils.latLonToXyz(e,t,this.mesh),a=GeoUtils.latLonToXyz(n,o,this.mesh),i=r.clone().sub(a).length(),l=r.clone().sub(this.mesh.position);l.normalize(),l.multiplyScalar(i),l.add(r);var s=a.clone().sub(this.mesh.position);s.normalize(),s.multiplyScalar(i),s.add(a);var d=new THREE.CubicBezierCurve3(r,l,s,a),u=new THREE.CurvePath;u.add(d);var c=u.createPointsGeometry(this.numberOfPoints);return c},e.prototype.doubleCubicFlux=function(e,t,n,o){var r=GeoUtils.latLonToXyz(e,t,this.mesh),a=GeoUtils.latLonToXyz(n,o,this.mesh),i=r.clone().sub(a).length(),l=r.clone().add(a).multiplyScalar(.5);l.sub(this.mesh.position),l.normalize(),l.multiplyScalar(this.mesh.geometry.radius+.2*i),l.add(this.mesh.position);var s=r.clone().sub(a);s.normalize();var d=l.clone().add(s.clone().multiplyScalar(i/2)),u=l.clone().add(s.clone().multiplyScalar(-i/2)),c=new THREE.CubicBezierCurve3(r,r,d,l),m=new THREE.CubicBezierCurve3(l,u,a,a),g=c.getPoints(this.numberOfPoints/2);g=g.splice(0,g.length-1),g=g.concat(m.getPoints(this.numberOfPoints/2));var h=new THREE.Geometry;return h.vertices=g,h},window.Flux=e}(),function(){function e(){a=document.getElementById("container"),m=window.innerWidth,g=window.innerHeight,d=new THREE.Scene,d.fog=new THREE.Fog(1118481,1800,2e3),l=new THREE.PerspectiveCamera(45,m/g,1,2e3),l.position.z=1500,l.lookAt(d.position),s=new THREE.OrbitControls(l),s.minDistance=500,s.maxDistance=2e3,s.addEventListener("change",r),i=new Stats,document.body.appendChild(i.domElement);var e=new dat.GUI;e.add(E,"speed",.001,.03),e.addColor(E,"fluxColor"),e.addColor(E,"clickColor"),u=new THREE.WebGLRenderer({antialias:!0}),u.setSize(m,g),u.domElement.style.position="absolute",a.appendChild(u.domElement),window.addEventListener("resize",t,!1),document.addEventListener("mousedown",n,!1);var o=THREE.ImageUtils.loadTexture("assets/img/world_4k_bw.png"),v=THREE.ImageUtils.loadTexture("assets/img/borders_map.png"),w=THREE.ImageUtils.loadTexture("assets/img/continents_map.png"),f=THREE.ImageUtils.loadTexture("assets/img/indexed_map.png");f.magFilter=THREE.NearestFilter,f.minFilter=THREE.NearestFilter,h={worldMap:{type:"t",value:o},bordersMap:{type:"t",value:v},continentsMap:{type:"t",value:w},indexMap:{type:"t",value:f},clicked:{type:"f",value:0},borderColor:{type:"c",value:new THREE.Color(16711680)}};var y=new THREE.ShaderMaterial({uniforms:h,vertexShader:Shaders.noopVertex,fragmentShader:Shaders.globeFragment});c=new Globe({texture:"assets/img/world_4k.jpg",radius:300,material:y}),d.add(c);var x=new THREE.AxisHelper(2*c.geometry.radius);d.add(x);var T=50,b=new Flux(c,T),C=THREE.ImageUtils.loadTexture("assets/img/texture.16.png");C.wrapS=THREE.RepeatWrapping,C.wrapT=THREE.RepeatWrapping,p={color:{type:"c",value:new THREE.Color(16711680)},texture:{type:"t",value:C},displacement:{type:"f",value:0}};var H=new THREE.ShaderMaterial({uniforms:p,vertexShader:Shaders.noopVertex,fragmentShader:Shaders.fluxFragment,blending:THREE.AdditiveBlending,depthTest:!0,depthWrite:!1,transparent:!0,linewidth:1}),R={latitude:47.21176,longitude:-1.573},M=new XMLHttpRequest;M.open("GET","assets/data/capitals.json",!0),M.onreadystatechange=function(){if(4===M.readyState&&200===M.status)for(var e,t=JSON.parse(M.responseText),n=0;n<t.length;n++){e=t[n];var o=b.doubleCubicFlux(R.latitude,R.longitude,e.latitude,e.longitude),r=new THREE.Line(o,H);d.add(r)}},M.send(null)}function t(){l.aspect=window.innerWidth/window.innerHeight,l.updateProjectionMatrix(),u.setSize(window.innerWidth,window.innerHeight),r()}function n(e){var t=u.context,n=e.clientX/t.canvas.clientWidth*2-1,o=2*-(e.clientY/t.canvas.clientHeight)+1,r=new THREE.Vector3(n,o,l.near),a=new THREE.Projector;a.unprojectVector(r,l);var i=new THREE.Raycaster(l.position,r.sub(l.position).normalize()),s=i.intersectObject(c,!0);if(s.length>0){var d=s[0].point;GeoUtils.getIndex(d,c,function(e){h.clicked.value=e/255,GeoUtils.getCountryCodeFromIndex(e,function(e){console.log(e)})})}}function o(){requestAnimationFrame(o),r(),i.update(),s.update()}function r(){p.displacement.value+=E.speed,p.color.value=new THREE.Color(E.fluxColor),h.borderColor.value=new THREE.Color(E.clickColor),u.render(d,l)}Detector.webgl||Detector.addGetWebGLMessage();var a,i,l,s,d,u,c,m,g,h,p,v=function(){this.speed=.004,this.fluxColor="#121314",this.clickColor="#7b7e9b"},E=new v;e(),o()}();