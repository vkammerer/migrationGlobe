"use strict";!function(){var e={};e.vertex1="\n		varying vec2 vUv;\n\n		void main() {\n			vUv = uv;\n			gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n		}\n	",e.fragment1="\n		uniform vec3 color;\n		uniform sampler2D texture;\n		uniform float displacement;\n		varying vec2 vUv;\n\n		void main() {\n			vec4 texColor = texture2D(texture, vec2(vUv.x-displacement, vUv.y));\n			gl_FragColor = texColor*vec4(color,1.0);\n		}\n	",window.Shaders=e}(),function(){var e=function(e){e=e||{};var t=e.radius||200,n=e.widthSegments||40,i=e.heightSegments||30,o=e.texture||"assets/img/world.jpg",r=THREE.ImageUtils.loadTexture(o),a=e.material||new THREE.MeshBasicMaterial({map:r}),s=new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture("assets/img/map_indexed.png")}),d=new THREE.SphereGeometry(t,n,i),l=THREE.SceneUtils.createMultiMaterialObject(d,[a,s]);return l.rotation.y=Math.PI,l.geometry=d,l};window.Globe=e}(),function(){var e=function(e,t){this.mesh=e,this.numberOfPoints=t};e.prototype.quadraticFlux=function(e,t,n,i){var o=this.coordToPoint(e,t),r=this.coordToPoint(n,i),a=o.clone().sub(r).length(),s=o.clone().add(r).multiplyScalar(.5);s.sub(this.mesh.position),s.normalize(),s.multiplyScalar(this.mesh.geometry.radius+.7*a),s.add(this.mesh.position);var d=new THREE.QuadraticBezierCurve3(o,s,r),l=new THREE.CurvePath;l.add(d);var c=l.createPointsGeometry(this.numberOfPoints);return c},e.prototype.cubicFlux=function(e,t,n,i){var o=this.coordToPoint(e,t),r=this.coordToPoint(n,i),a=o.clone().sub(r).length(),s=o.clone().sub(this.mesh.position);s.normalize(),s.multiplyScalar(a),s.add(o);var d=r.clone().sub(this.mesh.position);d.normalize(),d.multiplyScalar(a),d.add(r);var l=new THREE.CubicBezierCurve3(o,s,d,r),c=new THREE.CurvePath;c.add(l);var u=c.createPointsGeometry(this.numberOfPoints);return u},e.prototype.doubleCubicFlux=function(e,t,n,i){var o=this.coordToPoint(e,t),r=this.coordToPoint(n,i),a=o.clone().sub(r).length(),s=o.clone().add(r).multiplyScalar(.5);s.sub(this.mesh.position),s.normalize(),s.multiplyScalar(this.mesh.geometry.radius+.2*a),s.add(this.mesh.position);var d=o.clone().sub(r);d.normalize();var l=s.clone().add(d.clone().multiplyScalar(a/2)),c=s.clone().add(d.clone().multiplyScalar(-a/2)),u=new THREE.CubicBezierCurve3(o,o,l,s),m=new THREE.CubicBezierCurve3(s,c,r,r),h=u.getPoints(this.numberOfPoints/2);h=h.splice(0,h.length-1),h=h.concat(m.getPoints(this.numberOfPoints/2));var p=new THREE.Geometry;return p.vertices=h,p},e.prototype.coordToPoint=function(e,t){var n=(90-e)*Math.PI/180,i=(180-t)*Math.PI/180,o=new THREE.Vector3;return o.x=this.mesh.geometry.radius*Math.sin(n)*Math.cos(i),o.y=this.mesh.geometry.radius*Math.cos(n),o.z=this.mesh.geometry.radius*Math.sin(n)*Math.sin(i),o.add(this.mesh.position),o},window.Flux=e}(),function(){function e(){r=document.getElementById("container");var e=window.innerWidth,i=window.innerHeight;l=new THREE.Scene,l.fog=new THREE.Fog(1118481,1800,2e3),s=new THREE.PerspectiveCamera(45,e/i,1,2e3),s.position.z=1500,s.lookAt(l.position),d=new THREE.OrbitControls(s),d.minDistance=500,d.maxDistance=2e3,d.addEventListener("change",o),a=new Stats,document.body.appendChild(a.domElement);var p=new dat.GUI;p.add(E,"speed",.001,.03),p.addColor(E,"color"),c=new THREE.WebGLRenderer({antialias:!0}),c.setSize(e,i),c.domElement.style.position="absolute",r.appendChild(c.domElement),window.addEventListener("resize",t,!1),document.addEventListener("mousedown",n,!1),m=new THREE.Projector,u=new Globe({texture:"assets/img/world_4k.jpg",radius:300}),l.add(u);var v=50,w=new Flux(u,v),g=THREE.ImageUtils.loadTexture("assets/img/texture.16.png");g.wrapS=THREE.RepeatWrapping,g.wrapT=THREE.RepeatWrapping,h={color:{type:"c",value:new THREE.Color(16711680)},texture:{type:"t",value:g},displacement:{type:"f",value:0}};var T=new THREE.ShaderMaterial({uniforms:h,vertexShader:Shaders.vertex1,fragmentShader:Shaders.fragment1,blending:THREE.AdditiveBlending,depthTest:!0,depthWrite:!1,transparent:!0,linewidth:1}),H={latitude:47.21176,longitude:-1.573},R=new XMLHttpRequest;R.open("GET","assets/data/capitals.json",!0),R.onreadystatechange=function(){if(4===R.readyState&&200===R.status)for(var e,t=JSON.parse(R.responseText),n=0;n<t.length;n++){e=t[n];var i=w.doubleCubicFlux(H.latitude,H.longitude,e.latitude,e.longitude),o=new THREE.Line(i,T);l.add(o)}},R.send(null)}function t(){s.aspect=window.innerWidth/window.innerHeight,s.updateProjectionMatrix(),c.setSize(window.innerWidth,window.innerHeight),o()}function n(e){var t=e.clientX/window.innerWidth*2-1,n=2*-(e.clientY/window.innerHeight)+1,i=new THREE.Vector3(t,n,s.near),o=new THREE.Projector;o.unprojectVector(i,s);var r=new THREE.Raycaster(s.position,i.sub(s.position).normalize()),a=r.intersectObject(u,!0);if(a.length>0){console.log(a[1]);var d=a[1].point,c=new THREE.CubeGeometry(10,10,10),m=new THREE.MeshBasicMaterial({color:"red"}),h=new THREE.Mesh(c,m);h.position=d,l.add(h)}}function i(){requestAnimationFrame(i),o(),a.update(),d.update()}function o(){h.displacement.value+=E.speed,h.color.value=new THREE.Color(E.color),c.render(l,s)}Detector.webgl||Detector.addGetWebGLMessage();var r,a,s,d,l,c,u,m,h,p=function(){this.speed=.004,this.color="#00d3e1"},E=new p;e(),i()}();