"use strict";!function(){var e={};e.vertex1="\n		varying vec2 vUv;\n\n		void main() {\n			vUv = uv;\n			gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n		}\n	",e.fragment1="\n		uniform vec3 color;\n		uniform sampler2D texture;\n		uniform float displacement;\n		varying vec2 vUv;\n\n		void main() {\n			vec4 texColor = texture2D(texture, vec2(vUv.x+displacement, vUv.y));\n			gl_FragColor = texColor*vec4(color,1.0);\n		}\n	",window.Shaders=e}(),function(){var e=function(e){e=e||{};var t=e.radius||200,n=e.widthSegments||40,i=e.heightSegments||30,o=e.texture||"assets/img/world.jpg",r=THREE.ImageUtils.loadTexture(o),a=e.material||new THREE.MeshBasicMaterial({map:r}),s=new THREE.SphereGeometry(t,n,i),d=new THREE.Mesh(s,a);return d.rotation.y=Math.PI,d};window.Globe=e}(),function(){var e=function(e,t){this.mesh=e,this.numberOfPoints=t};e.prototype.quadraticFlux=function(e,t,n,i){var o=this.coordToPoint(e,t),r=this.coordToPoint(n,i),a=o.clone().sub(r).length(),s=o.clone().add(r).multiplyScalar(.5);s.sub(this.mesh.position),s.normalize(),s.multiplyScalar(this.mesh.geometry.radius+.7*a),s.add(this.mesh.position);var d=new THREE.QuadraticBezierCurve3(o,s,r),l=new THREE.CurvePath;l.add(d);var u=l.createPointsGeometry(this.numberOfPoints);return u},e.prototype.cubicFlux=function(e,t,n,i){var o=this.coordToPoint(e,t),r=this.coordToPoint(n,i),a=o.clone().sub(r).length(),s=o.clone().sub(this.mesh.position);s.normalize(),s.multiplyScalar(a),s.add(o);var d=r.clone().sub(this.mesh.position);d.normalize(),d.multiplyScalar(a),d.add(r);var l=new THREE.CubicBezierCurve3(o,s,d,r),u=new THREE.CurvePath;u.add(l);var c=u.createPointsGeometry(this.numberOfPoints);return c},e.prototype.doubleCubicFlux=function(e,t,n,i){var o=this.coordToPoint(e,t),r=this.coordToPoint(n,i),a=o.clone().sub(r).length(),s=o.clone().add(r).multiplyScalar(.5);s.sub(this.mesh.position),s.normalize(),s.multiplyScalar(this.mesh.geometry.radius+.2*a),s.add(this.mesh.position);var d=o.clone().sub(r);d.normalize();var l=s.clone().add(d.clone().multiplyScalar(a/2)),u=s.clone().add(d.clone().multiplyScalar(-a/2)),c=new THREE.CubicBezierCurve3(o,o,l,s),m=new THREE.CubicBezierCurve3(s,u,r,r),h=c.getPoints(this.numberOfPoints/2);h=h.splice(0,h.length-1),h=h.concat(m.getPoints(this.numberOfPoints));var p=new THREE.Geometry;return p.vertices=h,p},e.prototype.coordToPoint=function(e,t){var n=(90-e)*Math.PI/180,i=(180-t)*Math.PI/180,o=new THREE.Vector3;return o.x=this.mesh.geometry.radius*Math.sin(n)*Math.cos(i),o.y=this.mesh.geometry.radius*Math.cos(n),o.z=this.mesh.geometry.radius*Math.sin(n)*Math.sin(i),o.add(this.mesh.position),o},window.Flux=e}(),function(){function e(){o=document.getElementById("container");var e=window.innerWidth,n=window.innerHeight;a=new THREE.PerspectiveCamera(45,e/n,1,2e3),a.position.z=1500,s=new THREE.OrbitControls(a),s.minDistance=500,s.maxDistance=2e3,s.addEventListener("change",i),r=new Stats,document.body.appendChild(r.domElement),l=new THREE.WebGLRenderer({antialias:!0}),l.setSize(e,n),l.domElement.style.position="absolute",o.appendChild(l.domElement),d=new THREE.Scene,d.fog=new THREE.Fog(1118481,1800,2e3),window.addEventListener("resize",t,!1);var c=new Globe({texture:"assets/img/world_4k.jpg",radius:300});d.add(c);var m=50,h=new Flux(c,m),p=THREE.ImageUtils.loadTexture("assets/img/texture.16.png");p.wrapS=THREE.RepeatWrapping,p.wrapT=THREE.RepeatWrapping,u={color:{type:"c",value:new THREE.Color(16711680)},texture:{type:"t",value:p},displacement:{type:"f",value:0}};var v=new THREE.ShaderMaterial({uniforms:u,vertexShader:Shaders.vertex1,fragmentShader:Shaders.fragment1,blending:THREE.AdditiveBlending,depthTest:!0,depthWrite:!1,transparent:!0,linewidth:1}),E={latitude:47.21176,longitude:-1.573},w=new XMLHttpRequest;w.open("GET","assets/data/capitals.json",!0),w.onreadystatechange=function(){if(4===w.readyState&&200===w.status)for(var e,t=JSON.parse(w.responseText),n=0;n<t.length;n++){e=t[n];var i=h.doubleCubicFlux(E.latitude,E.longitude,e.latitude,e.longitude),o=new THREE.Line(i,v);d.add(o)}},w.send(null)}function t(){a.aspect=window.innerWidth/window.innerHeight,a.updateProjectionMatrix(),l.setSize(window.innerWidth,window.innerHeight),i()}function n(){requestAnimationFrame(n),i(),r.update(),s.update()}function i(){u.displacement.value+=.008,u.color.value.offsetHSL(5e-4,0,0),l.render(d,a)}Detector.webgl||Detector.addGetWebGLMessage();var o,r,a,s,d,l,u;e(),n()}();